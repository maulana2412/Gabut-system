<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>MATEMATIKA GABUT</title>
<style>
/* =========================================
   1. CORE STYLES & VARIABLES
   ========================================= */
:root {
    --bg-santuy: radial-gradient(circle at 50% 10%, #4a148c, #311b92, #000000);
    --bg-sepuh: radial-gradient(circle at 50% 10%, #b71c1c, #880e4f, #000000);
    
    --glass-bg: rgba(255, 255, 255, 0.1);
    --glass-border: 1px solid rgba(255, 255, 255, 0.15);
    --glass-blur: blur(12px);
    
    --btn-santuy: linear-gradient(135deg, #9c27b0, #673ab7);
    --btn-sepuh: linear-gradient(135deg, #d32f2f, #c2185b);
}

* { margin:0; padding:0; box-sizing:border-box; user-select: none; -webkit-tap-highlight-color: transparent; }

body {
    font-family: 'Segoe UI', 'Roboto', Helvetica, Arial, sans-serif;
    background: var(--bg-santuy);
    color: #fff;
    overflow-x: hidden;
    min-height: 100vh;
    transition: background 0.8s ease;
    padding-bottom: 60px;
    cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" style="fill:white"><circle cx="10" cy="10" r="5"/></svg>'), auto;
    text-align: center;
}

body.mode-hard { background: var(--bg-sepuh); }

/* =========================================
   2. ANIMATION & PARTICLES
   ========================================= */
.watermark-hdm {
    position: fixed; top: 15px; right: 20px; font-family: monospace; font-weight: 900;
    color: rgba(255, 255, 255, 0.5); border: 2px solid rgba(255, 255, 255, 0.3);
    padding: 4px 8px; border-radius: 6px; z-index: 9999; pointer-events: none; font-size: 12px;
}

@keyframes drunk {
    0% { transform: rotate(0deg) skew(0deg); }
    25% { transform: rotate(2deg) skew(2deg); }
    50% { transform: rotate(-2deg) skew(-1deg); }
    75% { transform: rotate(1deg) skew(1deg); }
    100% { transform: rotate(0deg) skew(0deg); }
}
.funny-anim { animation: drunk 3s infinite ease-in-out; margin: 0 auto; }

@keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-10px); } 75% { transform: translateX(10px); } }
.shake-anim { animation: shake 0.4s cubic-bezier(.36,.07,.19,.97) both; }

@keyframes popUp { 0% { transform: scale(0.95); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
.pop-anim { animation: popUp 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }

@keyframes bloomIn {
    0% { transform: scale(0) rotate(0deg); opacity: 0; }
    50% { opacity: 1; }
    100% { transform: scale(1.5) rotate(45deg); opacity: 0; }
}

.bloom-flower {
    position: fixed; pointer-events: none; z-index: 99999;
    width: 60px; height: 60px;
    animation: bloomIn 1s forwards ease-out;
}

#rain-container {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    pointer-events: none; z-index: 1; overflow: hidden;
}

.rain-particle {
    position: absolute; top: -50px; color: rgba(255,255,255,0.4);
    text-shadow: 0 0 5px rgba(255,255,255,0.3); animation: fall linear forwards;
}

@keyframes fall { to { transform: translateY(110vh) rotate(360deg); } }

/* =========================================
   3. LAYOUT & GLASSMORPHISM COMPONENTS
   ========================================= */
.container { 
    padding: 20px; max-width: 550px; margin: 0 auto; position: relative; 
    z-index: 2; text-align: left;
}

.hidden { display: none !important; }
.center { text-align: center; }

.top-banner {
    text-align: center; font-size: 14px; font-weight: bold; color: #ffd700;
    padding: 15px 0 5px 0; letter-spacing: 1.5px; text-shadow: 0 2px 5px rgba(0,0,0,0.5);
    border-bottom: 1px solid rgba(255,255,255,0.1); margin-bottom: 10px; width: 100%;
}

header {
    padding: 5px 10px 20px 10px; text-align: center; font-size: 24px; font-weight: 900; 
    text-transform: uppercase; letter-spacing: 1px;
    background: linear-gradient(to bottom, #fff, #e0e0e0); 
    -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    margin-bottom: 10px; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3)); width: 100%;
}

.glass-card {
    background: var(--glass-bg); backdrop-filter: var(--glass-blur);
    -webkit-backdrop-filter: var(--glass-blur); border: var(--glass-border);
    border-radius: 16px; padding: 20px; box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
    margin-bottom: 15px; transition: transform 0.2s;
}
.glass-card:hover { transform: translateY(-2px); }

input, button { width: 100%; padding: 16px; border-radius: 12px; border: none; font-size: 16px; outline: none; margin-bottom: 12px; transition: 0.3s; font-weight: bold;}
input { background: rgba(0,0,0,0.3); color: #fff; text-align: center; border: 1px solid rgba(255,255,255,0.2); }
input:focus { border-color: #fff; background: rgba(0,0,0,0.5); transform: scale(1.02); }

button {
    background: var(--btn-santuy); color: #fff; box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    text-transform: uppercase;letter-spacing: 0.5px; position: relative; overflow: hidden;
}
button:active { transform: scale(0.95); }
body.mode-hard button { background: var(--btn-sepuh); }
.btn-mode { background: #333 !important; border: 1px solid #555; color: #ccc; font-size: 14px; }
.btn-danger { background: transparent !important; border: 1px solid #ff3333; color: #ff3333; font-size: 13px; }

.krs-grid { display: flex; flex-direction: column; gap: 12px; }

.matkul-card {
    display: flex; justify-content: space-between; align-items: center;
    background: rgba(255, 255, 255, 0.07); backdrop-filter: blur(10px);
    padding: 18px; border-radius: 14px; border: 1px solid rgba(255,255,255,0.1);
    cursor: pointer; transition: all 0.2s; position: relative; overflow: hidden;
}
.matkul-card:hover { background: rgba(255,255,255,0.12); border-color: rgba(255,255,255,0.3); transform: scale(1.02);}

.mk-left { text-align: left; width: 65%; }
.mk-code { font-size: 11px; color: #ccc; letter-spacing: 0.5px; margin-bottom: 4px; }
.mk-name { font-size: 15px; font-weight: bold; color: #fff; }
.mk-right { text-align: right; width: 35%; display: flex; flex-direction: column; align-items: flex-end; gap: 5px; }
.mk-sks { font-size: 11px; color: #aaa; margin-bottom: 2px; }
.mk-grade-badge {
    background: #444; color: #fff; padding: 4px 10px; border-radius: 6px; 
    font-size: 14px; font-weight: 900; box-shadow: 0 2px 5px rgba(0,0,0,0.3);
    min-width: 40px; text-align: center;
}

#stats-bar {
    display: flex; justify-content: space-between; align-items: center;
    padding: 12px 18px; background: rgba(0,0,0,0.2);
    border-radius: 12px; margin-bottom: 20px; font-size: 14px;
    border: 1px solid rgba(255,255,255,0.1);
}
.ipk-badge {
    background: #444; color: #fff; padding: 5px 10px; border-radius: 8px; font-weight: 900; display: flex; align-items: center; gap: 8px;
}
.grade-letter { font-size: 18px; color: #ffd700; text-shadow: 0 0 5px rgba(255, 215, 0, 0.6); }

#q { 
    font-size: 1.3rem; font-weight: bold; min-height: 100px; 
    display: flex; flex-direction: column; align-items: center; justify-content: center; 
    text-align: center; margin-bottom: 25px; line-height: 1.5; 
    text-shadow: 0 2px 4px rgba(0,0,0,0.5); width: 100%;
}
sup { font-size: 0.7em; vertical-align: super; color: #ffd700; margin-left: 1px; }

#solusi-box {
    display: none; margin-top: 20px; background: rgba(255,255,255,0.1); 
    border-left: 4px solid #ffd700; border-radius: 8px;
    padding: 15px; font-size: 14px; text-align: left;
    line-height: 1.5; color: #e0e0e0;
}
.step { margin-bottom: 8px; display: block; }
.step-label { color: #ffd700; font-weight: bold; margin-right: 5px; }

.quote-box {
    margin-bottom: 20px; padding: 15px;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 12px; border: 1px dashed rgba(255,255,255,0.3);
    font-style: italic; color: #ccc; font-size: 13px; line-height: 1.4;
}
</style>
</head>
<body>

<div id="rain-container"></div>

<div class="top-banner funny-anim">‚ú® ANAK UNTAD PEJUANG KOS ‚ú®</div>
<div class="watermark-hdm">H.D.M</div>
<header class="funny-anim" style="animation-delay: 1s;">GAME GABUT</header>

<div class="container pop-anim" id="loginPage">
    <div class="glass-card" style="margin-top:30px; text-align:center;">
        <h2 style="margin-bottom: 10px; color:#ffd700;">MASUKKI DULU BOSKU</h2>
        <p style="font-size:13px; opacity:0.8; margin-bottom:25px;">Tulis nama panggilan ta' di sini.</p>
        <input type="text" id="inputNama" placeholder="Nama ta' siapa, Le?">
        <button onclick="saveUser()">GASKEUN MASUK üå∏</button>
    </div>
</div>

<div class="container hidden" id="modePage" style="text-align:center;">
    <h3 class="center" style="margin-bottom:25px; color:#fff; text-shadow: 0 2px 4px rgba(0,0,0,0.5);">PILIH LEVEL TA' BOSKU:</h3>
    <button onclick="selectMode('normal')" style="background:linear-gradient(135deg, #9c27b0, #673ab7); padding: 25px;">üòé MODE SANTUY (Masih Maba)</button>
    <button onclick="selectMode('hard')" style="background:linear-gradient(135deg, #d32f2f, #c2185b); padding: 25px;">üíÄ MODE SEPUH (ARTEFAK KAMPUS)</button>
</div>

<div class="container hidden" id="home">
    <div id="stats-bar" class="glass-card" style="padding: 15px; margin-bottom: 15px;">
        <div style="text-align:left">
            <span id="welcomeName" style="display:block; font-weight:900; font-size:16px;">HALO SAYANG KU</span>
            <span id="modeDisplay" style="font-size:11px; opacity:0.7; letter-spacing:1px;">MODE</span>
        </div>
        <div class="ipk-badge">
            <div style="text-align:right; line-height:1.1;">
                <span style="font-size:10px; display:block;">IPK</span>
                <span id="ipkDisplay" style="font-size:16px;">0.00</span>
            </div>
            <div class="grade-letter" id="gradeDisplay">-</div>
        </div>
    </div>

    <div class="quote-box center funny-anim">
        <span id="dailyQuote">"Tunggu sebentar..."</span>
    </div>

    <h4 style="margin-bottom:15px; padding-left: 5px; opacity: 0.9; font-size: 13px; letter-spacing: 1px;">KRS & HASIL STUDI TA':</h4>
    
    <div class="krs-grid" id="matkulList"></div>
    
    <div style="margin-top:30px; display:flex; flex-direction:column; gap:10px;">
        <button class="btn-mode" onclick="switchModeWithoutReset()">üîÄ Ganti Level Dulu Le</button>
        <button class="btn-danger" onclick="resetGame()">üóëÔ∏è Ulang Dari Awal (Reset)</button>
    </div>
</div>

<div class="container hidden" id="gameArea">
    <div id="stats-bar" style="background:transparent; border:none; padding:0;">
        <span id="matkulName" style="font-weight:900; color:#ffd700; letter-spacing:1px;">MATKUL</span>
        <button onclick="backHome()" style="width:auto; padding:8px 15px; font-size:12px; background:rgba(255,255,255,0.1); border:1px solid rgba(255,255,255,0.3); box-shadow:none; margin:0;">KEMBALI KE KRS</button>
    </div>

    <div class="glass-card" style="cursor:default; margin: 20px 0; padding: 10px 20px;">
        <div id="q" class="funny-anim">Loading soal...</div>
    </div>

    <input type="text" id="ans" placeholder="Isi jawaban ta' di sini..." autocomplete="off">
    <div id="res" class="center" style="font-weight:900; margin:15px 0; font-size: 18px; min-height: 24px;"></div>
    
    <div id="solusi-box">
        <div style="font-weight:bold; margin-bottom:8px; color:#ffd700;">üí° PENJELASAN:</div>
        <div id="solusi-text"></div>
    </div>

    <button onclick="checkAnswer()" id="btnJawab" style="margin-top: 10px;">KUNCI MI (SUBMIT)</button>
    <button style="background:rgba(0,0,0,0.4); border: 1px solid #555; color:#aaa;" onclick="generateQuestion()" id="btnSkip">SKIP DULU BOSKU</button>
</div>

<script>
/* =========================================
   ANIMATION ENGINES
   ========================================= */
const rainSymbols = ['üå∏', 'üå∫', 'üå∑', '‚àë', '‚à´', 'œÄ', '‚àö', '‚àû', '‚â†', '√∑', '√ó', '‚ù§Ô∏è'];
const rainContainer = document.getElementById('rain-container');

function createRainParticle() {
    const el = document.createElement('div');
    el.classList.add('rain-particle');
    el.innerText = rainSymbols[Math.floor(Math.random() * rainSymbols.length)];
    el.style.left = Math.random() * 100 + 'vw';
    const duration = Math.random() * 10 + 5; 
    el.style.animationDuration = duration + 's';
    el.style.fontSize = (Math.random() * 20 + 10) + 'px';
    rainContainer.appendChild(el);
    setTimeout(() => { el.remove(); }, duration * 1000);
}
setInterval(createRainParticle, 300);

function createFlower(x, y, colorType) {
    const flower = document.createElement('div');
    flower.className = 'bloom-flower';
    flower.style.left = (x - 30) + 'px'; 
    flower.style.top = (y - 30) + 'px';  
    const randomRot = Math.random() * 360;
    
    let svgContent = '';
    if (colorType === 'purple') {
        svgContent = `<svg viewBox="0 0 100 100" fill="#e040fb" xmlns="http://www.w3.org/2000/svg" style="filter: drop-shadow(0 0 5px white);"><path d="M50 50 C20 0 80 0 50 50 C80 0 100 40 50 50 C100 40 100 90 50 50 C100 90 20 100 50 50 C20 100 0 60 50 50 C0 60 20 0 50 50 Z" /><circle cx="50" cy="50" r="10" fill="#ffeb3b" /></svg>`;
    } else if (colorType === 'red') {
        svgContent = `<svg viewBox="0 0 100 100" fill="#d50000" xmlns="http://www.w3.org/2000/svg" style="filter: drop-shadow(0 0 5px black);"><path d="M50 50 L30 10 L50 30 L70 10 L50 50 L90 30 L70 50 L90 70 L50 50 L70 90 L50 70 L30 90 L50 50 L10 70 L30 50 L10 30 Z" /><circle cx="50" cy="50" r="8" fill="#000" /></svg>`;
    } else {
        const colors = ['#f8bbd0', '#e1bee7', '#b2dfdb', '#fff9c4'];
        const randCol = colors[Math.floor(Math.random() * colors.length)];
        svgContent = `<svg viewBox="0 0 100 100" fill="${randCol}" xmlns="http://www.w3.org/2000/svg" style="opacity:0.7"><circle cx="50" cy="50" r="40" /></svg>`;
    }

    flower.innerHTML = svgContent;
    flower.style.transform = `rotate(${randomRot}deg)`;
    document.body.appendChild(flower);
    setTimeout(() => { flower.remove(); }, 1000);
}

document.addEventListener('click', (e) => {
    if(e.target.tagName !== 'BUTTON' && e.target.tagName !== 'INPUT') {
        createFlower(e.clientX, e.clientY, 'random');
    }
});

function triggerFlowerExplosion(type) {
    const count = 15; const w = window.innerWidth; const h = window.innerHeight;
    for (let i = 0; i < count; i++) {
        setTimeout(() => {
            const x = Math.random() * w; const y = Math.random() * h;
            createFlower(x, y, type);
        }, i * 50);
    }
}

/* =========================================
   DATA & CONFIG
   ========================================= */
const $ = (id) => document.getElementById(id);
let userData = { name: "", total: 0, benar: 0, matkulStats: {} };
let currentMode = "normal"; 
let currentMatkul = {}; 
let currentQ = { a: "", s: [] }; 
let isLocked = false;

// DATABASE MATKUL
const dbMatkul = [
    { type: 'math',  code: "bikin pusing", name: "Aljabar Linier", sks: 3 },
    { type: 'calc',  code: "stress ngana", name: "Kalkulus Dasar", sks: 3 },
    { type: 'stat',  code: "hitung uang", name: "Statistika Dasar", sks: 2 },
    { type: 'eng',   code: "bahasa alien", name: "Bahasa Inggris", sks: 2 },
    { type: 'numb',  code: "gampang kok", name: "Teori Bilangan", sks: 3 },
    { type: 'logic', code: "pikir pake logika", name: "Logika Matematika", sks: 2 },
    { type: 'edu',   code: "calon guru", name: "Ilmu Pendidikan", sks: 2 }
];

/* =========================================
   LIST KATA-KATA (BUCIN & EJEKAN) - DIEDIT DISINI
   ========================================= */
const sindiranList = [
    "Aih, bikin malu orang tua di kampung!", 
    "Pulang mako saja tanam jagung, Le.", 
    "Kebanyakan makan burjo ini anak.",
    "Astagah, begini saja ndak tau? Hapus KRS mi.", 
    "Kosong melompong otak ta' Kanda.",
    "Belum lunas uang kos mu kah? Kurang fokus ki.", 
    "Weh, sadar diri. Nilai E sudah di depan mata.",
    "Mending tidur mako kalau begini jawabanmu.", 
    "Kurang minum air galon ini.",
    "Hadeh, beban keluarga betul."
];

// LIST BUCIN - DITAMBAHKAN NAMA NANTI DI FUNGSI CHECK
const gombalanList = [
    "Duh, meleleh aku liat pintarmu", 
    "Makin sayang deh sama", 
    "Fix, kamu idaman banget", 
    "Senyummu seindah jawabanmu", 
    "I love you 3000", 
    "Ugh, damagenya ngeri sayangku", 
    "Mau nggak jadi pacarku",
    "Otakmu seksi sekali",
    "Jantungku berdegup kencang liat",
    "Kamu emang andalan hatiku"
];

const kosQuotes = [
    "Saldo ATM tinggal kenangan, Indomie jadi harapan.", "Kuliah di Untad, 'Tondo' adalah ujian fisik terberat.",
    "Nunggu kiriman orang tua lebih deg-degan daripada nunggu nilai keluar.", "Cita-cita lulus cepat, realita semester tua.",
    "Wi-Fi kampus adalah koentji... kalau tersambung.", "Jauh dari orang tua mengajarkanku arti berhemat.",
    "Tanggal tua adalah momen di mana promag jadi cemilan.", "Panasnya Palu mengajarkanku untuk selalu tabah."
];

function init() {
    let stored = localStorage.getItem('untadDataGabutV1');
    if (stored) {
        userData = JSON.parse(stored);
        if(!userData.matkulStats) userData.matkulStats = {}; 
        if (userData.name) {
            $("loginPage").classList.add("hidden");
            $("modePage").classList.remove("hidden");
        }
    }
}
init();

function saveUser() {
    let val = $("inputNama").value.trim();
    if (!val) return alert("Isi nama dulu bosku!");
    userData.name = val;
    userData.matkulStats = {}; 
    saveData();
    $("loginPage").classList.add("hidden");
    $("modePage").classList.remove("hidden");
}

function selectMode(mode) {
    currentMode = mode;
    if (mode === 'hard') {
        document.body.classList.add('mode-hard');
        $("modeDisplay").innerText = "MODE SEPUH";
    } else {
        document.body.classList.remove('mode-hard');
        $("modeDisplay").innerText = "MODE SANTUY";
    }
    renderKRS(); 
    $("modePage").classList.add("hidden");
    $("home").classList.remove("hidden");
    updateUI();
    showRandomQuote();
}

function switchModeWithoutReset() {
    $("home").classList.add("hidden");
    $("modePage").classList.remove("hidden");
}

function showRandomQuote() {
    let rand = kosQuotes[Math.floor(Math.random() * kosQuotes.length)];
    $("dailyQuote").innerText = `"${rand}"`;
}

function renderKRS() {
    const container = $("matkulList");
    container.innerHTML = "";
    dbMatkul.forEach((mk, index) => {
        let stats = userData.matkulStats[mk.type] || { b: 0, t: 0 };
        let gradeLetter = "-";
        let badgeColor = "#555";
        
        if (stats.t > 0) {
            let score = stats.b / stats.t; 
            gradeLetter = getGradeLetterFromScore(score);
            badgeColor = getBadgeColor(gradeLetter);
        }

        let el = document.createElement("div");
        el.className = "matkul-card";
        el.onclick = () => startMat(index);
        el.innerHTML = `
            <div class="mk-left">
                <div class="mk-code">${mk.code.toUpperCase()}</div>
                <div class="mk-name">${mk.name}</div>
            </div>
            <div class="mk-right">
                <div class="mk-sks">${mk.sks} SKS</div>
                <div class="mk-grade-badge" style="background:${badgeColor}">${gradeLetter}</div>
            </div>
        `;
        container.appendChild(el);
    });
}

function getGradeLetterFromScore(score) {
    if (score >= 0.80) return "A";
    if (score >= 0.70) return "B"; 
    if (score >= 0.55) return "C";
    if (score >= 0.40) return "D";
    return "E";
}

function getBadgeColor(grade) {
    if(grade === 'A') return "#00c853"; 
    if(grade === 'B') return "#0091ea"; 
    if(grade === 'C') return "#fbc02d"; 
    if(grade === 'D') return "#ff6d00"; 
    if(grade === 'E') return "#d50000"; 
    return "#555"; 
}

function updateUI() {
    $("welcomeName").innerText = "HALO SAYANG KU " + userData.name;
    
    let ipk = userData.total === 0 ? 0 : (userData.benar/userData.total)*4.0;
    $("ipkDisplay").innerText = ipk.toFixed(2);
    let globalScore = userData.total === 0 ? 0 : userData.benar/userData.total;
    let globalGrade = userData.total === 0 ? "-" : getGradeLetterFromScore(globalScore);
    $("gradeDisplay").innerText = globalGrade;
    $("gradeDisplay").style.color = getBadgeColor(globalGrade);
}

function saveData() {
    localStorage.setItem('untadDataGabutV1', JSON.stringify(userData));
    updateUI();
}

function backHome() {
    $("gameArea").classList.add("hidden");
    $("home").classList.remove("hidden");
    renderKRS(); 
    updateUI();
    showRandomQuote(); 
}

function resetGame() {
    if(confirm("Yakin hapus data? Kembali jadi Maba nanti!")) {
        localStorage.clear();
        location.reload();
    }
}

// --- UTILITY ---
function rand(min, max) { return Math.floor(Math.random() * (max - min + 1)) + min; }
function randArr(arr) { return arr[Math.floor(Math.random() * arr.length)]; }

// --- GAME LOGIC ---
function startMat(index) {
    currentMatkul = dbMatkul[index];
    $("home").classList.add("hidden");
    $("gameArea").classList.remove("hidden");
    $("gameArea").classList.add("pop-anim");
    $("matkulName").innerText = currentMatkul.name.toUpperCase();
    generateQuestion();
}

function generateQuestion() {
    isLocked = false;
    $("ans").value = ""; $("res").innerText = ""; $("solusi-box").style.display = "none";
    $("btnJawab").innerText = "KUNCI MI (SUBMIT)";
    $("btnJawab").style.background = currentMode === 'hard' ? "var(--btn-sepuh)" : "var(--btn-santuy)";
    $("ans").focus();

    const generators = {
        'math': genAljabar,
        'calc': genKalkulus,
        'stat': genStatistika,
        'eng': genInggris,
        'numb': genTeoriBil,
        'logic': genLogika,
        'edu': genPendidikan
    };
    
    let rawQ = generators[currentMatkul.type]();
    $("q").innerHTML = rawQ.text;
    currentQ.a = rawQ.ans;
    currentQ.s = rawQ.steps;
}

/* =========================================
   SOAL - SOAL 
   ========================================= */

/* --- 1. ALJABAR LINIER (MATRIX & VEKTOR) --- */
function genAljabar() {
    const type = rand(0, 3);
    let r1 = rand(2,9), r2 = rand(2,9), r3 = rand(1,5);
    
    if(type === 0) { 
        return {
            text: `Hitung Determinan Matriks ini:<br>| ${r1} &nbsp; ${r3} |<br>| ${r2} &nbsp; 2 |`,
            ans: (r1*2) - (r3*r2),
            steps: [`Rumus Determinan (ad - bc).<br>(${r1} x 2) - (${r3} x ${r2}) = <b>${(r1*2)-(r3*r2)}</b>`]
        };
    } else if (type === 1) { 
        return {
            text: `Elemen baris 1 kolom 2 dari Transpose matriks ini:<br>[ ${r1} &nbsp; 5 ]<br>[ ${r2} &nbsp; 9 ]`,
            ans: r2,
            steps: [`Transpose itu baris jadi kolom, Le.<br>Hasil Transpose: <br>[ ${r1} &nbsp; ${r2} ]<br>[ 5 &nbsp; 9 ]<br>Jawabannya <b>${r2}</b>`]
        };
    } else if (type === 2) { 
        return {
            text: `Jika u = (${r1}, ${r2}) dan v = (2, 3).<br>Maka u + v = (x, y). Berapa nilai x?`,
            ans: r1 + 2,
            steps: [`Tinggal jumlahin depannya aja.<br>${r1} + 2 = <b>${r1+2}</b>`]
        };
    } else { 
        return {
            text: `Dot Product vektor a=(${r1}, 1) dan b=(2, ${r2}) berapa?`,
            ans: (r1*2) + (1*r2),
            steps: [`Kalikan yang seposisi lalu jumlahkan.<br>(${r1} x 2) + (1 x ${r2}) = <b>${(r1*2)+r2}</b>`]
        };
    }
}

/* --- 2. KALKULUS (TURUNAN & INTEGRAL) --- */
function genKalkulus() {
    const type = rand(0, 2);
    let c = rand(2, 8); let p = rand(2, 4);
    
    if(type === 0) { 
        return {
            text: `Turunan pertama f(x) = ${c}x<sup>${p}</sup> pada x = 1?`,
            ans: c * p,
            steps: [`Pangkat dikali koefisien.<br>${p} x ${c} = <b>${p*c}</b>`]
        };
    } else if (type === 1) { 
        let upper = 2;
        return {
            text: `Hitung ‚à´ 2x dx dari batas 0 sampai ${upper}`,
            ans: upper * upper,
            steps: [`Integral 2x itu x<sup>2</sup>.<br>Masukin ${upper} kuadrat = <b>${upper*upper}</b>`]
        };
    } else { 
        let val = rand(1,5);
        return {
            text: `Limit x mendekati ${val} dari (2x + 5) berapa?`,
            ans: (2*val)+5,
            steps: [`Masukin aja x nya, jangan malas.<br>2(${val}) + 5 = <b>${(2*val)+5}</b>`]
        };
    }
}

/* --- 3. STATISTIKA (DATA, MEAN, PELUANG) --- */
function genStatistika() {
    const type = rand(0, 3);
    
    if(type === 0) { 
        let d1 = rand(2,6)*10, d2 = d1+10, d3 = d1+20;
        return {
            text: `Rata-rata (Mean) dari data: ${d1}, ${d2}, ${d3}?`,
            ans: d2,
            steps: [`Jumlahin bagi 3.<br>(${d1}+${d2}+${d3}) / 3 = <b>${d2}</b>`]
        };
    } else if (type === 1) { 
        return {
            text: `Rumus Z-score adalah (x - Mean) dibagi apa?`,
            ans: ["sd", "standar deviasi", "simpangan baku"],
            steps: [`Dibagi <b>Simpangan Baku</b> atau Standar Deviasi.`]
        };
    } else if (type === 2) { 
        return {
            text: `Median (tengah) dari data: 5, 2, 8, 9, 3?`,
            ans: 5,
            steps: [`Urutin dulu: 2, 3, 5, 8, 9. Tengahnya <b>5</b>`]
        };
    } else { 
        return {
            text: `Peluang muncul angka 5 pada dadu? (Desimal 2 angka)`,
            ans: "0.17",
            steps: [`1 dibagi 6 itu 0.1666... dibulatkan jadi <b>0.17</b>`]
        };
    }
}

/* --- 4. BAHASA INGGRIS --- */
function genInggris() {
    const db = [
        { q: "Bentuk jamak (plural) dari 'Mouse'?", a: "mice", s: "Ingat Le, Mouse itu irregular noun. Jadi Mice." },
        { q: "V2 (Past Tense) dari 'Go'?", a: "went", s: "Go - Went - Gone." },
        { q: "Isi titik-titik: She ___ (study) English everyday.", a: ["studies", "study"], s: "Karena She (tunggal), pakai Studies." },
        { q: "Pronoun 'Me' itu Subject atau Object?", a: "object", s: "Subject itu I, Object itu Me." },
        { q: "Translate: 'Dosen Pembimbing'", a: ["supervisor", "academic advisor"], s: "Academic Advisor atau Supervisor." },
        { q: "Jamak dari 'Child' apa?", a: "children", s: "Child jadi Children." }
    ];
    let item = randArr(db);
    return { text: item.q, ans: item.a, steps: [item.s] };
}

/* --- 5. TEORI BILANGAN --- */
function genTeoriBil() {
    const type = rand(0, 2);
    let a = rand(3, 9), b = rand(2, 5);
    
    if(type === 0) { 
        let num = (a*5) + b;
        return {
            text: `Sisa bagi (Modulo) dari ${num} dibagi 5 berapa?`,
            ans: b,
            steps: [`${num} dibagi 5 itu sisa <b>${b}</b>.`]
        };
    } else if (type === 1) { 
        return {
            text: `KPK dari 4 dan 6 adalah?`,
            ans: 12,
            steps: [`Kelipatan yang sama paling kecil itu <b>12</b>`]
        };
    } else { 
        return {
            text: `Bilangan biner 101 kalau diubah ke desimal jadi berapa?`,
            ans: 5,
            steps: [`4 + 0 + 1 = <b>5</b>`]
        };
    }
}

/* --- 6. LOGIKA --- */
function genLogika() {
    const db = [
        { q: "Jika P Benar, Q Salah. Maka P AND Q nilainya?", a: "salah", s: "Logika 'DAN' butuh dua-duanya benar. Jadi Salah." },
        { q: "Negasi dari 'Semua mahasiswa lulus'?", a: ["ada mahasiswa tidak lulus", "beberapa mahasiswa tidak lulus"], s: "Lawan 'Semua' itu 'Ada yang tidak'." },
        { q: "Simbol 'V' terbalik itu artinya apa?", a: ["dan", "and"], s: "Itu konjungsi atau DAN." },
        { q: "Implikasi P -> Q hanya SALAH jika?", a: ["p benar q salah", "benar salah"], s: "Awal Benar, Akhir Salah (BS = S)." }
    ];
    let item = randArr(db);
    return { text: item.q, ans: item.a, steps: [item.s] };
}

/* --- 7. PENDIDIKAN --- */
function genPendidikan() {
    const db = [
        { q: "Langkah pertama PBL (Problem Based Learning)?", a: ["identifikasi masalah", "orientasi masalah"], s: "Orientasi/Identifikasi Masalah dulu." },
        { q: "Semboyan 'Tut Wuri Handayani' dari siapa?", a: ["ki hajar dewantara", "kh dewantara"], s: "Bapak Pendidikan kita." },
        { q: "Kompetensi guru: Pedagogik, Profesional, Sosial, dan...?", a: "kepribadian", s: "Harus punya Kepribadian yang baik." }
    ];
    let item = randArr(db);
    return { text: item.q, ans: item.a, steps: [item.s] };
}

// --- CHECK ANSWER ---
function checkAnswer() {
    if(isLocked) return;
    isLocked = true;
    
    let userAns = $("ans").value.toLowerCase().trim();
    let isCorrect = false;
    let key = currentQ.a;

    if(Array.isArray(key)) {
        isCorrect = key.some(k => userAns.includes(String(k).toLowerCase()));
    } else {
        const strKey = String(key).toLowerCase();
        isCorrect = userAns === strKey || (strKey.length > 3 && userAns.includes(strKey));
    }
    
    userData.total++;
    
    if(!userData.matkulStats) userData.matkulStats = {};
    if(!userData.matkulStats[currentMatkul.type]) {
        userData.matkulStats[currentMatkul.type] = { b: 0, t: 0 };
    }
    userData.matkulStats[currentMatkul.type].t++;

    if(isCorrect) {
        userData.benar++;
        userData.matkulStats[currentMatkul.type].b++; 
        
        // LOGIC BUCIN + NAMA DI SINI
        let randomGombal = gombalanList[rand(0, gombalanList.length-1)];
        $("res").innerHTML = `<span style="color:#e040fb; text-shadow: 0 0 10px rgba(224,64,251,0.5);">‚ú® BENAR! ${randomGombal} ${userData.name} üòç</span>`;
        triggerFlowerExplosion('purple');
    } else {
        // LOGIC EJEKAN DI SINI
        let randomSindir = sindiranList[rand(0, sindiranList.length-1)];
        $("res").innerHTML = `<span style="color:#ff3d00; text-shadow: 0 0 10px rgba(255,61,0,0.5);">üíÄ SALAH! ${randomSindir}</span>`;
        triggerFlowerExplosion('red');
        $("gameArea").classList.add("shake-anim");
        setTimeout(()=>$("gameArea").classList.remove("shake-anim"), 400);
    }
    
    $("solusi-box").style.display = "block";
    
    let htmlSteps = "";
    currentQ.s.forEach((step, i) => {
        htmlSteps += `<div class="step"><span class="step-label">Langkah ${i+1}:</span> ${step}</div>`;
    });
    
    if(!isCorrect) {
        let correctVal = Array.isArray(key) ? key[0] : key;
        htmlSteps += `<div style="margin-top:10px; border-top:1px dashed #555; paddingTop:5px;">Jawabannya <b>${correctVal}</b> Le.</div>`;
    }
    
    $("solusi-text").innerHTML = htmlSteps;
    saveData(); 
}

$("ans").addEventListener("keypress", (e)=>{if(e.key==="Enter") checkAnswer()});

</script>
</body>
</html>

}

#stats-bar {
    display: flex; justify-content: space-between; align-items: center;
    padding: 12px 18px; background: rgba(0,0,0,0.2);
    border-radius: 12px; margin-bottom: 20px; font-size: 14px;
    border: 1px solid rgba(255,255,255,0.1);
}
.ipk-badge {
    background: #444; color: #fff; padding: 5px 10px; border-radius: 8px; font-weight: 900; display: flex; align-items: center; gap: 8px;
}
.grade-letter { font-size: 18px; color: #ffd700; text-shadow: 0 0 5px rgba(255, 215, 0, 0.6); }

#q { 
    font-size: 1.3rem; font-weight: bold; min-height: 100px; 
    display: flex; flex-direction: column; align-items: center; justify-content: center; 
    text-align: center; margin-bottom: 25px; line-height: 1.5; 
    text-shadow: 0 2px 4px rgba(0,0,0,0.5); width: 100%;
}
sup { font-size: 0.7em; vertical-align: super; color: #ffd700; margin-left: 1px; }

#solusi-box {
    display: none; margin-top: 20px; background: rgba(255,255,255,0.1); 
    border-left: 4px solid #ffd700; border-radius: 8px;
    padding: 15px; font-size: 14px; text-align: left;
    line-height: 1.5; color: #e0e0e0;
}
.step { margin-bottom: 8px; display: block; }
.step-label { color: #ffd700; font-weight: bold; margin-right: 5px; }

.quote-box {
    margin-bottom: 20px; padding: 15px;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 12px; border: 1px dashed rgba(255,255,255,0.3);
    font-style: italic; color: #ccc; font-size: 13px; line-height: 1.4;
}
</style>
</head>
<body>

<div id="rain-container"></div>

<div class="top-banner funny-anim">‚ú® ANAK UNTAD PEJUANG KOS ‚ú®</div>
<div class="watermark-hdm">H.D.M</div>
<header class="funny-anim" style="animation-delay: 1s;">GAME BUCIN GABUT</header>

<div class="container pop-anim" id="loginPage">
    <div class="glass-card" style="margin-top:30px; text-align:center;">
        <h2 style="margin-bottom: 10px; color:#ffd700;">MASUKKI DULU BOSKU</h2>
        <p style="font-size:13px; opacity:0.8; margin-bottom:25px;">Tulis nama panggilan ta' di sini.</p>
        <input type="text" id="inputNama" placeholder="Nama ta' siapa, Le?">
        <button onclick="saveUser()">GASKEUN MASUK üå∏</button>
    </div>
</div>

<div class="container hidden" id="modePage" style="text-align:center;">
    <h3 class="center" style="margin-bottom:25px; color:#fff; text-shadow: 0 2px 4px rgba(0,0,0,0.5);">PILIH LEVEL TA' BOSKU:</h3>
    <button onclick="selectMode('normal')" style="background:linear-gradient(135deg, #9c27b0, #673ab7); padding: 25px;">üòé MODE SANTUY (Masih Maba)</button>
    <button onclick="selectMode('hard')" style="background:linear-gradient(135deg, #d32f2f, #c2185b); padding: 25px;">üíÄ MODE SEPUH (ARTEFAK KAMPUS)</button>
</div>

<div class="container hidden" id="home">
    <div id="stats-bar" class="glass-card" style="padding: 15px; margin-bottom: 15px;">
        <div style="text-align:left">
            <span id="welcomeName" style="display:block; font-weight:900; font-size:16px;">HALO SAYANG KU</span>
            <span id="modeDisplay" style="font-size:11px; opacity:0.7; letter-spacing:1px;">MODE</span>
        </div>
        <div class="ipk-badge">
            <div style="text-align:right; line-height:1.1;">
                <span style="font-size:10px; display:block;">IPK</span>
                <span id="ipkDisplay" style="font-size:16px;">0.00</span>
            </div>
            <div class="grade-letter" id="gradeDisplay">-</div>
        </div>
    </div>

    <div class="quote-box center funny-anim">
        <span id="dailyQuote">"Tunggu sebentar..."</span>
    </div>

    <h4 style="margin-bottom:15px; padding-left: 5px; opacity: 0.9; font-size: 13px; letter-spacing: 1px;">KRS & HASIL STUDI TA':</h4>
    
    <div class="krs-grid" id="matkulList"></div>
    
    <div style="margin-top:30px; display:flex; flex-direction:column; gap:10px;">
        <button class="btn-mode" onclick="switchModeWithoutReset()">üîÄ Ganti Level Dulu Le</button>
        <button class="btn-danger" onclick="resetGame()">üóëÔ∏è Ulang Dari Awal (Reset)</button>
    </div>
</div>

<div class="container hidden" id="gameArea">
    <div id="stats-bar" style="background:transparent; border:none; padding:0;">
        <span id="matkulName" style="font-weight:900; color:#ffd700; letter-spacing:1px;">MATKUL</span>
        <button onclick="backHome()" style="width:auto; padding:8px 15px; font-size:12px; background:rgba(255,255,255,0.1); border:1px solid rgba(255,255,255,0.3); box-shadow:none; margin:0;">KEMBALI KE KRS</button>
    </div>

    <div class="glass-card" style="cursor:default; margin: 20px 0; padding: 10px 20px;">
        <div id="q" class="funny-anim">Loading soal...</div>
    </div>

    <input type="text" id="ans" placeholder="Isi jawaban ta' di sini..." autocomplete="off">
    <div id="res" class="center" style="font-weight:900; margin:15px 0; font-size: 18px; min-height: 24px;"></div>
    
    <div id="solusi-box">
        <div style="font-weight:bold; margin-bottom:8px; color:#ffd700;">üí° PENJELASAN:</div>
        <div id="solusi-text"></div>
    </div>

    <button onclick="checkAnswer()" id="btnJawab" style="margin-top: 10px;">KUNCI MI (SUBMIT)</button>
    <button style="background:rgba(0,0,0,0.4); border: 1px solid #555; color:#aaa;" onclick="generateQuestion()" id="btnSkip">SKIP DULU BOSKU</button>
</div>

<script>
/* =========================================
   ANIMATION ENGINES
   ========================================= */
const rainSymbols = ['üå∏', 'üå∫', 'üå∑', '‚àë', '‚à´', 'œÄ', '‚àö', '‚àû', '‚â†', '√∑', '√ó', '‚ù§Ô∏è'];
const rainContainer = document.getElementById('rain-container');

function createRainParticle() {
    const el = document.createElement('div');
    el.classList.add('rain-particle');
    el.innerText = rainSymbols[Math.floor(Math.random() * rainSymbols.length)];
    el.style.left = Math.random() * 100 + 'vw';
    const duration = Math.random() * 10 + 5; 
    el.style.animationDuration = duration + 's';
    el.style.fontSize = (Math.random() * 20 + 10) + 'px';
    rainContainer.appendChild(el);
    setTimeout(() => { el.remove(); }, duration * 1000);
}
setInterval(createRainParticle, 300);

function createFlower(x, y, colorType) {
    const flower = document.createElement('div');
    flower.className = 'bloom-flower';
    flower.style.left = (x - 30) + 'px'; 
    flower.style.top = (y - 30) + 'px';  
    const randomRot = Math.random() * 360;
    
    let svgContent = '';
    if (colorType === 'purple') {
        svgContent = `<svg viewBox="0 0 100 100" fill="#e040fb" xmlns="http://www.w3.org/2000/svg" style="filter: drop-shadow(0 0 5px white);"><path d="M50 50 C20 0 80 0 50 50 C80 0 100 40 50 50 C100 40 100 90 50 50 C100 90 20 100 50 50 C20 100 0 60 50 50 C0 60 20 0 50 50 Z" /><circle cx="50" cy="50" r="10" fill="#ffeb3b" /></svg>`;
    } else if (colorType === 'red') {
        svgContent = `<svg viewBox="0 0 100 100" fill="#d50000" xmlns="http://www.w3.org/2000/svg" style="filter: drop-shadow(0 0 5px black);"><path d="M50 50 L30 10 L50 30 L70 10 L50 50 L90 30 L70 50 L90 70 L50 50 L70 90 L50 70 L30 90 L50 50 L10 70 L30 50 L10 30 Z" /><circle cx="50" cy="50" r="8" fill="#000" /></svg>`;
    } else {
        const colors = ['#f8bbd0', '#e1bee7', '#b2dfdb', '#fff9c4'];
        const randCol = colors[Math.floor(Math.random() * colors.length)];
        svgContent = `<svg viewBox="0 0 100 100" fill="${randCol}" xmlns="http://www.w3.org/2000/svg" style="opacity:0.7"><circle cx="50" cy="50" r="40" /></svg>`;
    }

    flower.innerHTML = svgContent;
    flower.style.transform = `rotate(${randomRot}deg)`;
    document.body.appendChild(flower);
    setTimeout(() => { flower.remove(); }, 1000);
}

document.addEventListener('click', (e) => {
    if(e.target.tagName !== 'BUTTON' && e.target.tagName !== 'INPUT') {
        createFlower(e.clientX, e.clientY, 'random');
    }
});

function triggerFlowerExplosion(type) {
    const count = 15; const w = window.innerWidth; const h = window.innerHeight;
    for (let i = 0; i < count; i++) {
        setTimeout(() => {
            const x = Math.random() * w; const y = Math.random() * h;
            createFlower(x, y, type);
        }, i * 50);
    }
}

/* =========================================
   DATA & CONFIG
   ========================================= */
const $ = (id) => document.getElementById(id);
let userData = { name: "", total: 0, benar: 0, matkulStats: {} };
let currentMode = "normal"; 
let currentMatkul = {}; 
let currentQ = { a: "", s: [] }; 
let isLocked = false;

// DATABASE MATKUL
const dbMatkul = [
    { type: 'math',  code: "bikin pusing", name: "Aljabar Linier", sks: 3 },
    { type: 'calc',  code: "stress ngana", name: "Kalkulus Dasar", sks: 3 },
    { type: 'stat',  code: "hitung uang", name: "Statistika Dasar", sks: 2 },
    { type: 'eng',   code: "bahasa alien", name: "Bahasa Inggris", sks: 2 },
    { type: 'numb',  code: "gampang kok", name: "Teori Bilangan", sks: 3 },
    { type: 'logic', code: "pikir pake logika", name: "Logika Matematika", sks: 2 },
    { type: 'edu',   code: "calon guru", name: "Ilmu Pendidikan", sks: 2 }
];

/* =========================================
   LIST KATA-KATA (BUCIN & EJEKAN) - DIEDIT DISINI
   ========================================= */
const sindiranList = [
    "Aih, bikin malu orang tua di kampung!", 
    "Pulang mako saja tanam jagung, Le.", 
    "Kebanyakan makan burjo ini anak.",
    "Astagah, begini saja ndak tau? Hapus KRS mi.", 
    "Kosong melompong otak ta' Kanda.",
    "Belum lunas uang kos mu kah? Kurang fokus ki.", 
    "Weh, sadar diri. Nilai E sudah di depan mata.",
    "Mending tidur mako kalau begini jawabanmu.", 
    "Kurang minum air galon ini.",
    "Hadeh, beban keluarga betul."
];

// LIST BUCIN - DITAMBAHKAN NAMA NANTI DI FUNGSI CHECK
const gombalanList = [
    "Duh, meleleh aku liat pintarmu", 
    "Makin sayang deh sama", 
    "Fix, kamu idaman banget", 
    "Senyummu seindah jawabanmu", 
    "I love you 3000", 
    "Ugh, damagenya ngeri sayangku", 
    "Mau nggak jadi pacarku",
    "Otakmu seksi sekali",
    "Jantungku berdegup kencang liat",
    "Kamu emang andalan hatiku"
];

const kosQuotes = [
    "Saldo ATM tinggal kenangan, Indomie jadi harapan.", "Kuliah di Untad, 'Tondo' adalah ujian fisik terberat.",
    "Nunggu kiriman orang tua lebih deg-degan daripada nunggu nilai keluar.", "Cita-cita lulus cepat, realita semester tua.",
    "Wi-Fi kampus adalah koentji... kalau tersambung.", "Jauh dari orang tua mengajarkanku arti berhemat.",
    "Tanggal tua adalah momen di mana promag jadi cemilan.", "Panasnya Palu mengajarkanku untuk selalu tabah."
];

function init() {
    let stored = localStorage.getItem('untadDataGabutV1');
    if (stored) {
        userData = JSON.parse(stored);
        if(!userData.matkulStats) userData.matkulStats = {}; 
        if (userData.name) {
            $("loginPage").classList.add("hidden");
            $("modePage").classList.remove("hidden");
        }
    }
}
init();

function saveUser() {
    let val = $("inputNama").value.trim();
    if (!val) return alert("Isi nama dulu bosku!");
    userData.name = val;
    userData.matkulStats = {}; 
    saveData();
    $("loginPage").classList.add("hidden");
    $("modePage").classList.remove("hidden");
}

function selectMode(mode) {
    currentMode = mode;
    if (mode === 'hard') {
        document.body.classList.add('mode-hard');
        $("modeDisplay").innerText = "MODE SEPUH";
    } else {
        document.body.classList.remove('mode-hard');
        $("modeDisplay").innerText = "MODE SANTUY";
    }
    renderKRS(); 
    $("modePage").classList.add("hidden");
    $("home").classList.remove("hidden");
    updateUI();
    showRandomQuote();
}

function switchModeWithoutReset() {
    $("home").classList.add("hidden");
    $("modePage").classList.remove("hidden");
}

function showRandomQuote() {
    let rand = kosQuotes[Math.floor(Math.random() * kosQuotes.length)];
    $("dailyQuote").innerText = `"${rand}"`;
}

function renderKRS() {
    const container = $("matkulList");
    container.innerHTML = "";
    dbMatkul.forEach((mk, index) => {
        let stats = userData.matkulStats[mk.type] || { b: 0, t: 0 };
        let gradeLetter = "-";
        let badgeColor = "#555";
        
        if (stats.t > 0) {
            let score = stats.b / stats.t; 
            gradeLetter = getGradeLetterFromScore(score);
            badgeColor = getBadgeColor(gradeLetter);
        }

        let el = document.createElement("div");
        el.className = "matkul-card";
        el.onclick = () => startMat(index);
        el.innerHTML = `
            <div class="mk-left">
                <div class="mk-code">${mk.code.toUpperCase()}</div>
                <div class="mk-name">${mk.name}</div>
            </div>
            <div class="mk-right">
                <div class="mk-sks">${mk.sks} SKS</div>
                <div class="mk-grade-badge" style="background:${badgeColor}">${gradeLetter}</div>
            </div>
        `;
        container.appendChild(el);
    });
}

function getGradeLetterFromScore(score) {
    if (score >= 0.80) return "A";
    if (score >= 0.70) return "B"; 
    if (score >= 0.55) return "C";
    if (score >= 0.40) return "D";
    return "E";
}

function getBadgeColor(grade) {
    if(grade === 'A') return "#00c853"; 
    if(grade === 'B') return "#0091ea"; 
    if(grade === 'C') return "#fbc02d"; 
    if(grade === 'D') return "#ff6d00"; 
    if(grade === 'E') return "#d50000"; 
    return "#555"; 
}

function updateUI() {
    $("welcomeName").innerText = "HALO SAYANG KU " + userData.name;
    
    let ipk = userData.total === 0 ? 0 : (userData.benar/userData.total)*4.0;
    $("ipkDisplay").innerText = ipk.toFixed(2);
    let globalScore = userData.total === 0 ? 0 : userData.benar/userData.total;
    let globalGrade = userData.total === 0 ? "-" : getGradeLetterFromScore(globalScore);
    $("gradeDisplay").innerText = globalGrade;
    $("gradeDisplay").style.color = getBadgeColor(globalGrade);
}

function saveData() {
    localStorage.setItem('untadDataGabutV1', JSON.stringify(userData));
    updateUI();
}

function backHome() {
    $("gameArea").classList.add("hidden");
    $("home").classList.remove("hidden");
    renderKRS(); 
    updateUI();
    showRandomQuote(); 
}

function resetGame() {
    if(confirm("Yakin hapus data? Kembali jadi Maba nanti!")) {
        localStorage.clear();
        location.reload();
    }
}

// --- UTILITY ---
function rand(min, max) { return Math.floor(Math.random() * (max - min + 1)) + min; }
function randArr(arr) { return arr[Math.floor(Math.random() * arr.length)]; }

// --- GAME LOGIC ---
function startMat(index) {
    currentMatkul = dbMatkul[index];
    $("home").classList.add("hidden");
    $("gameArea").classList.remove("hidden");
    $("gameArea").classList.add("pop-anim");
    $("matkulName").innerText = currentMatkul.name.toUpperCase();
    generateQuestion();
}

function generateQuestion() {
    isLocked = false;
    $("ans").value = ""; $("res").innerText = ""; $("solusi-box").style.display = "none";
    $("btnJawab").innerText = "KUNCI MI (SUBMIT)";
    $("btnJawab").style.background = currentMode === 'hard' ? "var(--btn-sepuh)" : "var(--btn-santuy)";
    $("ans").focus();

    const generators = {
        'math': genAljabar,
        'calc': genKalkulus,
        'stat': genStatistika,
        'eng': genInggris,
        'numb': genTeoriBil,
        'logic': genLogika,
        'edu': genPendidikan
    };
    
    let rawQ = generators[currentMatkul.type]();
    $("q").innerHTML = rawQ.text;
    currentQ.a = rawQ.ans;
    currentQ.s = rawQ.steps;
}

/* =========================================
   SOAL - SOAL 
   ========================================= */

/* --- 1. ALJABAR LINIER (MATRIX & VEKTOR) --- */
function genAljabar() {
    const type = rand(0, 3);
    let r1 = rand(2,9), r2 = rand(2,9), r3 = rand(1,5);
    
    if(type === 0) { 
        return {
            text: `Hitung Determinan Matriks ini:<br>| ${r1} &nbsp; ${r3} |<br>| ${r2} &nbsp; 2 |`,
            ans: (r1*2) - (r3*r2),
            steps: [`Rumus Determinan (ad - bc).<br>(${r1} x 2) - (${r3} x ${r2}) = <b>${(r1*2)-(r3*r2)}</b>`]
        };
    } else if (type === 1) { 
        return {
            text: `Elemen baris 1 kolom 2 dari Transpose matriks ini:<br>[ ${r1} &nbsp; 5 ]<br>[ ${r2} &nbsp; 9 ]`,
            ans: r2,
            steps: [`Transpose itu baris jadi kolom, Le.<br>Hasil Transpose: <br>[ ${r1} &nbsp; ${r2} ]<br>[ 5 &nbsp; 9 ]<br>Jawabannya <b>${r2}</b>`]
        };
    } else if (type === 2) { 
        return {
            text: `Jika u = (${r1}, ${r2}) dan v = (2, 3).<br>Maka u + v = (x, y). Berapa nilai x?`,
            ans: r1 + 2,
            steps: [`Tinggal jumlahin depannya aja.<br>${r1} + 2 = <b>${r1+2}</b>`]
        };
    } else { 
        return {
            text: `Dot Product vektor a=(${r1}, 1) dan b=(2, ${r2}) berapa?`,
            ans: (r1*2) + (1*r2),
            steps: [`Kalikan yang seposisi lalu jumlahkan.<br>(${r1} x 2) + (1 x ${r2}) = <b>${(r1*2)+r2}</b>`]
        };
    }
}

/* --- 2. KALKULUS (TURUNAN & INTEGRAL) --- */
function genKalkulus() {
    const type = rand(0, 2);
    let c = rand(2, 8); let p = rand(2, 4);
    
    if(type === 0) { 
        return {
            text: `Turunan pertama f(x) = ${c}x<sup>${p}</sup> pada x = 1?`,
            ans: c * p,
            steps: [`Pangkat dikali koefisien.<br>${p} x ${c} = <b>${p*c}</b>`]
        };
    } else if (type === 1) { 
        let upper = 2;
        return {
            text: `Hitung ‚à´ 2x dx dari batas 0 sampai ${upper}`,
            ans: upper * upper,
            steps: [`Integral 2x itu x<sup>2</sup>.<br>Masukin ${upper} kuadrat = <b>${upper*upper}</b>`]
        };
    } else { 
        let val = rand(1,5);
        return {
            text: `Limit x mendekati ${val} dari (2x + 5) berapa?`,
            ans: (2*val)+5,
            steps: [`Masukin aja x nya, jangan malas.<br>2(${val}) + 5 = <b>${(2*val)+5}</b>`]
        };
    }
}

/* --- 3. STATISTIKA (DATA, MEAN, PELUANG) --- */
function genStatistika() {
    const type = rand(0, 3);
    
    if(type === 0) { 
        let d1 = rand(2,6)*10, d2 = d1+10, d3 = d1+20;
        return {
            text: `Rata-rata (Mean) dari data: ${d1}, ${d2}, ${d3}?`,
            ans: d2,
            steps: [`Jumlahin bagi 3.<br>(${d1}+${d2}+${d3}) / 3 = <b>${d2}</b>`]
        };
    } else if (type === 1) { 
        return {
            text: `Rumus Z-score adalah (x - Mean) dibagi apa?`,
            ans: ["sd", "standar deviasi", "simpangan baku"],
            steps: [`Dibagi <b>Simpangan Baku</b> atau Standar Deviasi.`]
        };
    } else if (type === 2) { 
        return {
            text: `Median (tengah) dari data: 5, 2, 8, 9, 3?`,
            ans: 5,
            steps: [`Urutin dulu: 2, 3, 5, 8, 9. Tengahnya <b>5</b>`]
        };
    } else { 
        return {
            text: `Peluang muncul angka 5 pada dadu? (Desimal 2 angka)`,
            ans: "0.17",
            steps: [`1 dibagi 6 itu 0.1666... dibulatkan jadi <b>0.17</b>`]
        };
    }
}

/* --- 4. BAHASA INGGRIS --- */
function genInggris() {
    const db = [
        { q: "Bentuk jamak (plural) dari 'Mouse'?", a: "mice", s: "Ingat Le, Mouse itu irregular noun. Jadi Mice." },
        { q: "V2 (Past Tense) dari 'Go'?", a: "went", s: "Go - Went - Gone." },
        { q: "Isi titik-titik: She ___ (study) English everyday.", a: ["studies", "study"], s: "Karena She (tunggal), pakai Studies." },
        { q: "Pronoun 'Me' itu Subject atau Object?", a: "object", s: "Subject itu I, Object itu Me." },
        { q: "Translate: 'Dosen Pembimbing'", a: ["supervisor", "academic advisor"], s: "Academic Advisor atau Supervisor." },
        { q: "Jamak dari 'Child' apa?", a: "children", s: "Child jadi Children." }
    ];
    let item = randArr(db);
    return { text: item.q, ans: item.a, steps: [item.s] };
}

/* --- 5. TEORI BILANGAN --- */
function genTeoriBil() {
    const type = rand(0, 2);
    let a = rand(3, 9), b = rand(2, 5);
    
    if(type === 0) { 
        let num = (a*5) + b;
        return {
            text: `Sisa bagi (Modulo) dari ${num} dibagi 5 berapa?`,
            ans: b,
            steps: [`${num} dibagi 5 itu sisa <b>${b}</b>.`]
        };
    } else if (type === 1) { 
        return {
            text: `KPK dari 4 dan 6 adalah?`,
            ans: 12,
            steps: [`Kelipatan yang sama paling kecil itu <b>12</b>`]
        };
    } else { 
        return {
            text: `Bilangan biner 101 kalau diubah ke desimal jadi berapa?`,
            ans: 5,
            steps: [`4 + 0 + 1 = <b>5</b>`]
        };
    }
}

/* --- 6. LOGIKA --- */
function genLogika() {
    const db = [
        { q: "Jika P Benar, Q Salah. Maka P AND Q nilainya?", a: "salah", s: "Logika 'DAN' butuh dua-duanya benar. Jadi Salah." },
        { q: "Negasi dari 'Semua mahasiswa lulus'?", a: ["ada mahasiswa tidak lulus", "beberapa mahasiswa tidak lulus"], s: "Lawan 'Semua' itu 'Ada yang tidak'." },
        { q: "Simbol 'V' terbalik itu artinya apa?", a: ["dan", "and"], s: "Itu konjungsi atau DAN." },
        { q: "Implikasi P -> Q hanya SALAH jika?", a: ["p benar q salah", "benar salah"], s: "Awal Benar, Akhir Salah (BS = S)." }
    ];
    let item = randArr(db);
    return { text: item.q, ans: item.a, steps: [item.s] };
}

/* --- 7. PENDIDIKAN --- */
function genPendidikan() {
    const db = [
        { q: "Langkah pertama PBL (Problem Based Learning)?", a: ["identifikasi masalah", "orientasi masalah"], s: "Orientasi/Identifikasi Masalah dulu." },
        { q: "Semboyan 'Tut Wuri Handayani' dari siapa?", a: ["ki hajar dewantara", "kh dewantara"], s: "Bapak Pendidikan kita." },
        { q: "Kompetensi guru: Pedagogik, Profesional, Sosial, dan...?", a: "kepribadian", s: "Harus punya Kepribadian yang baik." }
    ];
    let item = randArr(db);
    return { text: item.q, ans: item.a, steps: [item.s] };
}

// --- CHECK ANSWER ---
function checkAnswer() {
    if(isLocked) return;
    isLocked = true;
    
    let userAns = $("ans").value.toLowerCase().trim();
    let isCorrect = false;
    let key = currentQ.a;

    if(Array.isArray(key)) {
        isCorrect = key.some(k => userAns.includes(String(k).toLowerCase()));
    } else {
        const strKey = String(key).toLowerCase();
        isCorrect = userAns === strKey || (strKey.length > 3 && userAns.includes(strKey));
    }
    
    userData.total++;
    
    if(!userData.matkulStats) userData.matkulStats = {};
    if(!userData.matkulStats[currentMatkul.type]) {
        userData.matkulStats[currentMatkul.type] = { b: 0, t: 0 };
    }
    userData.matkulStats[currentMatkul.type].t++;

    if(isCorrect) {
        userData.benar++;
        userData.matkulStats[currentMatkul.type].b++; 
        
        // LOGIC BUCIN + NAMA DI SINI
        let randomGombal = gombalanList[rand(0, gombalanList.length-1)];
        $("res").innerHTML = `<span style="color:#e040fb; text-shadow: 0 0 10px rgba(224,64,251,0.5);">‚ú® BENAR! ${randomGombal} ${userData.name} üòç</span>`;
        triggerFlowerExplosion('purple');
    } else {
        // LOGIC EJEKAN DI SINI
        let randomSindir = sindiranList[rand(0, sindiranList.length-1)];
        $("res").innerHTML = `<span style="color:#ff3d00; text-shadow: 0 0 10px rgba(255,61,0,0.5);">üíÄ SALAH! ${randomSindir}</span>`;
        triggerFlowerExplosion('red');
        $("gameArea").classList.add("shake-anim");
        setTimeout(()=>$("gameArea").classList.remove("shake-anim"), 400);
    }
    
    $("solusi-box").style.display = "block";
    
    let htmlSteps = "";
    currentQ.s.forEach((step, i) => {
        htmlSteps += `<div class="step"><span class="step-label">Langkah ${i+1}:</span> ${step}</div>`;
    });
    
    if(!isCorrect) {
        let correctVal = Array.isArray(key) ? key[0] : key;
        htmlSteps += `<div style="margin-top:10px; border-top:1px dashed #555; paddingTop:5px;">Jawabannya <b>${correctVal}</b> Le.</div>`;
    }
    
    $("solusi-text").innerHTML = htmlSteps;
    saveData(); 
}

$("ans").addEventListener("keypress", (e)=>{if(e.key==="Enter") checkAnswer()});

</script>
</body>
</html>
